"use strict";var le=Object.create;var v=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var fe=(e,r)=>{for(var o in r)v(e,o,{get:r[o],enumerable:!0})},H=(e,r,o,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of pe(r))!ue.call(e,t)&&t!==o&&v(e,t,{get:()=>r[t],enumerable:!(i=se(r,t))||i.enumerable});return e};var c=(e,r,o)=>(o=e!=null?le(ce(e)):{},H(r||!e||!e.__esModule?v(o,"default",{value:e,enumerable:!0}):o,e)),me=e=>H(v({},"__esModule",{value:!0}),e);var _e={};fe(_e,{CldImage:()=>X,CldOgImage:()=>Y,CldUploadButton:()=>k,CldUploadWidget:()=>O,CldVideoPlayer:()=>B,cloudinaryLoader:()=>D});module.exports=me(_e);var V=c(require("react")),G=c(require("next/image")),q=require("@cloudinary-util/util"),J=require("@cloudinary-util/url-loader");async function j(e){let{src:r}=e;try{await new Promise((o,i)=>{fetch(r).then(t=>{if(!t.ok){i(t);return}o(t)})})}catch(o){return o.status===423?await j(e):!1}return!0}var z=require("@cloudinary-util/url-loader");var K=c(require("next/package.json"));var F={name:"next-cloudinary",version:"4.0.1",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.0.0","@cloudinary-util/util":"^2.0.0","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var T="V",b=F.version,A=K.default.version;function D({loaderOptions:e,imageProps:r,cldOptions:o,cldConfig:i={}}){let t={...r,...o};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let y=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*y))}return(0,z.constructCloudinaryUrl)({options:t,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME},...i},analytics:{sdkCode:T,sdkSemver:b,techVersion:A,feature:""}})}var ye=e=>{let r=["deliveryType","preserveTransformations"];J.transformationPlugins.forEach(({props:n=[]})=>{n.forEach(d=>{if(r.includes(d))throw new Error(`Option ${d} already exists!`);r.push(d)})});let o={alt:e.alt,src:e.src};Object.keys(e).filter(n=>!r.includes(n)).forEach(n=>o[n]=e[n]);let i=Object.keys(o).map(n=>`${n}:${o[n]}`).join(";"),[t,y]=(0,V.useState)(i),s={};if(r.forEach(n=>{e[n]&&(s[n]=e[n]||void 0)}),e.preserveTransformations)try{let n=(0,q.getTransformations)(e.src);s.rawTransformations=[...n.flat(),...e.rawTransformations||[]]}catch(n){console.warn(`Failed to preserve transformations: ${n.message}`)}async function p(n){await j({src:n.target.src})&&y(`${i};${Date.now()}`)}return V.default.createElement(G.default,{key:t,...o,loader:n=>D({loaderOptions:n,imageProps:o,cldOptions:s}),onError:p})},X=ye;var g=c(require("react")),Q=c(require("next/head")),Z=require("@cloudinary-util/url-loader");var Ce=2400,he=1200,Pe="summary_large_image",Ie=({excludeTags:e=[],twitterTitle:r,...o})=>{let i={...o,alt:o.alt,crop:o.crop||"fill",gravity:o.gravity||"center",height:o.height||he,src:o.src,width:o.width||Ce},t=(0,Z.constructCloudinaryUrl)({options:i,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},analytics:{sdkCode:T,sdkSemver:b,techVersion:A,feature:""}});return g.default.createElement(Q.default,null,g.default.createElement("meta",{property:"og:image",content:t}),g.default.createElement("meta",{property:"og:image:secure_url",content:t}),g.default.createElement("meta",{property:"og:image:width",content:`${i.width}`}),g.default.createElement("meta",{property:"og:image:height",content:`${i.height}`}),i.alt&&g.default.createElement("meta",{property:"og:image:alt",content:i.alt}),!e.includes("twitter:title")&&g.default.createElement("meta",{property:"twitter:title",content:r||" "}),g.default.createElement("meta",{property:"twitter:card",content:Pe}),g.default.createElement("meta",{property:"twitter:image",content:t}))},Y=Ie;var L=c(require("react"));var a=c(require("react")),te=c(require("next/script"));function ee(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ee=["success","display-changed"];var Ue=({children:e,onClose:r,onError:o,onOpen:i,onUpload:t,options:y,signatureEndpoint:s,uploadPreset:p})=>{let n=(0,a.useRef)(),d=(0,a.useRef)(),P=!!s,[I,R]=(0,a.useState)(void 0),[C,S]=(0,a.useState)(void 0),E={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:p||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...y};P&&(E.uploadSignature=N,E.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,a.useEffect)(()=>{if(typeof C=="undefined")return;let u=C.event==="success",f=C.event==="display-changed"&&C.info==="hidden";u&&typeof t=="function"&&t(C,d.current),f&&typeof r=="function"&&r(d.current)},[C]),(0,a.useEffect)(()=>{I&&typeof o=="function"&&o(I,d.current)},[I]);function _(){n.current||(n.current=window.cloudinary),ee(()=>{d.current||(d.current=w())})}function N(u,f){if(typeof s=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(s,{method:"POST",body:JSON.stringify({paramsToSign:f})}).then(m=>m.json()).then(({signature:m})=>{u(m)})}function w(){var u;return(u=n.current)==null?void 0:u.createUploadWidget(E,(f,m)=>{typeof f!="undefined"&&R(f),Ee.includes(m==null?void 0:m.event)&&S(m)})}function x(){d.current||(d.current=w()),d==null||d.current.open(),typeof i=="function"&&i(d.current)}return a.default.createElement(a.default.Fragment,null,typeof e=="function"&&e({cloudinary:n.current,widget:d.current,open:x,results:C,error:I}),a.default.createElement(te.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:_,onError:u=>console.error(`Failed to load Cloudinary Upload Widget: ${u.message}`)}))},O=Ue;var Oe=({children:e,onClick:r,onError:o,onUpload:i,options:t,signatureEndpoint:y,uploadPreset:s,...p})=>L.default.createElement(L.default.Fragment,null,L.default.createElement(O,{onError:o,onUpload:i,options:t,signatureEndpoint:y,uploadPreset:s},({open:n})=>{function d(P){P.preventDefault(),n(),typeof r=="function"&&r(P)}return L.default.createElement("button",{...p,onClick:d},e||"Upload")})),k=Oe;var l=c(require("react")),oe=c(require("next/script")),re=c(require("next/head")),Le=e=>{let{autoPlay:r="never",colors:o,controls:i=!0,fontFace:t,height:y,id:s,logo:p=!0,loop:n=!1,muted:d=!1,onDataLoad:P,onError:I,onMetadataLoad:R,onPause:C,onPlay:S,onEnded:E,src:_,version:N="1.9.4",width:w}=e,x=(0,l.useRef)(),u=(0,l.useRef)(),f=e.videoRef||u,m=(0,l.useRef)(),W=e.playerRef||m,ne=s||`player-${_.replace("/","-")}`,M={error:I,loadeddata:P,loadedmetadata:R,pause:C,play:S,ended:E};function ie(h){let U=M[h.type];typeof U=="function"&&U(ae())}function de(){if("cloudinary"in window){x.current=window.cloudinary;let h={};typeof p=="boolean"?h.showLogo=p:typeof p=="object"&&(h={...h,showLogo:!0,logoImageUrl:p.imageUrl,logoOnclickUrl:p.onClickUrl}),W.current=x.current.videoPlayer(f.current,{autoplayMode:r,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,color:o,controls:i,fontFace:t||"",loop:n,muted:d,publicId:_,secure:!0,...h}),Object.keys(M).forEach(U=>{var $;typeof M[U]=="function"&&(($=W.current)==null||$.on(U,ie))})}}function ae(){return{player:W.current,video:f.current}}return l.default.createElement(l.default.Fragment,null,l.default.createElement(re.default,null,l.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${N}/dist/cld-video-player.min.css`,rel:"stylesheet"})),l.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},l.default.createElement("video",{ref:f,id:ne,className:"cld-video-player cld-fluid",width:w,height:y}),l.default.createElement(oe.default,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${N}/dist/cld-video-player.min.js`,onLoad:de,onError:h=>console.error(`Failed to load Cloudinary Video Player: ${h.message}`)})))},B=Le;0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader});
//# sourceMappingURL=index.js.map