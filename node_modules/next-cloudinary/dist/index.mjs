import te,{useState as oe}from"react";import re from"next/image";import{getTransformations as ne}from"@cloudinary-util/util";import{transformationPlugins as ie}from"@cloudinary-util/url-loader";async function V(e){let{src:d}=e;try{await new Promise((r,i)=>{fetch(d).then(t=>{if(!t.ok){i(t);return}r(t)})})}catch(r){return r.status===423?await V(e):!1}return!0}import{constructCloudinaryUrl as ee}from"@cloudinary-util/url-loader";import Z from"next/package.json";var j={name:"next-cloudinary",version:"4.0.1",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.0.0","@cloudinary-util/util":"^2.0.0","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var _="V",N=j.version,w=Z.version;function R({loaderOptions:e,imageProps:d,cldOptions:r,cldConfig:i={}}){let t={...d,...r};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let u=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*u))}return ee({options:t,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME},...i},analytics:{sdkCode:_,sdkSemver:N,techVersion:w,feature:""}})}var de=e=>{let d=["deliveryType","preserveTransformations"];ie.forEach(({props:o=[]})=>{o.forEach(n=>{if(d.includes(n))throw new Error(`Option ${n} already exists!`);d.push(n)})});let r={alt:e.alt,src:e.src};Object.keys(e).filter(o=>!d.includes(o)).forEach(o=>r[o]=e[o]);let i=Object.keys(r).map(o=>`${o}:${r[o]}`).join(";"),[t,u]=oe(i),a={};if(d.forEach(o=>{e[o]&&(a[o]=e[o]||void 0)}),e.preserveTransformations)try{let o=ne(e.src);a.rawTransformations=[...o.flat(),...e.rawTransformations||[]]}catch(o){console.warn(`Failed to preserve transformations: ${o.message}`)}async function l(o){await V({src:o.target.src})&&u(`${i};${Date.now()}`)}return te.createElement(re,{key:t,...r,loader:o=>R({loaderOptions:o,imageProps:r,cldOptions:a}),onError:l})},X=de;import m from"react";import ae from"next/head";import{constructCloudinaryUrl as le}from"@cloudinary-util/url-loader";var se=2400,pe=1200,ce="summary_large_image",ue=({excludeTags:e=[],twitterTitle:d,...r})=>{let i={...r,alt:r.alt,crop:r.crop||"fill",gravity:r.gravity||"center",height:r.height||pe,src:r.src,width:r.width||se},t=le({options:i,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},analytics:{sdkCode:_,sdkSemver:N,techVersion:w,feature:""}});return m.createElement(ae,null,m.createElement("meta",{property:"og:image",content:t}),m.createElement("meta",{property:"og:image:secure_url",content:t}),m.createElement("meta",{property:"og:image:width",content:`${i.width}`}),m.createElement("meta",{property:"og:image:height",content:`${i.height}`}),i.alt&&m.createElement("meta",{property:"og:image:alt",content:i.alt}),!e.includes("twitter:title")&&m.createElement("meta",{property:"twitter:title",content:d||" "}),m.createElement("meta",{property:"twitter:card",content:ce}),m.createElement("meta",{property:"twitter:image",content:t}))},Y=ue;import v from"react";import S,{useState as B,useEffect as $,useRef as H}from"react";import fe from"next/script";function k(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var me=["success","display-changed"];var ge=({children:e,onClose:d,onError:r,onOpen:i,onUpload:t,options:u,signatureEndpoint:a,uploadPreset:l})=>{let o=H(),n=H(),C=!!a,[h,T]=B(void 0),[f,b]=B(void 0),P={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:l||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...u};C&&(P.uploadSignature=U,P.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),$(()=>{if(typeof f=="undefined")return;let s=f.event==="success",p=f.event==="display-changed"&&f.info==="hidden";s&&typeof t=="function"&&t(f,n.current),p&&typeof d=="function"&&d(n.current)},[f]),$(()=>{h&&typeof r=="function"&&r(h,n.current)},[h]);function E(){o.current||(o.current=window.cloudinary),k(()=>{n.current||(n.current=O())})}function U(s,p){if(typeof a=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(a,{method:"POST",body:JSON.stringify({paramsToSign:p})}).then(c=>c.json()).then(({signature:c})=>{s(c)})}function O(){var s;return(s=o.current)==null?void 0:s.createUploadWidget(P,(p,c)=>{typeof p!="undefined"&&T(p),me.includes(c==null?void 0:c.event)&&b(c)})}function L(){n.current||(n.current=O()),n==null||n.current.open(),typeof i=="function"&&i(n.current)}return S.createElement(S.Fragment,null,typeof e=="function"&&e({cloudinary:o.current,widget:n.current,open:L,results:f,error:h}),S.createElement(fe,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:E,onError:s=>console.error(`Failed to load Cloudinary Upload Widget: ${s.message}`)}))},x=ge;var ye=({children:e,onClick:d,onError:r,onUpload:i,options:t,signatureEndpoint:u,uploadPreset:a,...l})=>v.createElement(v.Fragment,null,v.createElement(x,{onError:r,onUpload:i,options:t,signatureEndpoint:u,uploadPreset:a},({open:o})=>{function n(C){C.preventDefault(),o(),typeof d=="function"&&d(C)}return v.createElement("button",{...l,onClick:n},e||"Upload")})),F=ye;import y,{useRef as W}from"react";import Ce from"next/script";import he from"next/head";var Pe=e=>{let{autoPlay:d="never",colors:r,controls:i=!0,fontFace:t,height:u,id:a,logo:l=!0,loop:o=!1,muted:n=!1,onDataLoad:C,onError:h,onMetadataLoad:T,onPause:f,onPlay:b,onEnded:P,src:E,version:U="1.9.4",width:O}=e,L=W(),s=W(),p=e.videoRef||s,c=W(),A=e.playerRef||c,z=a||`player-${E.replace("/","-")}`,D={error:h,loadeddata:C,loadedmetadata:T,pause:f,play:b,ended:P};function G(g){let I=D[g.type];typeof I=="function"&&I(J())}function q(){if("cloudinary"in window){L.current=window.cloudinary;let g={};typeof l=="boolean"?g.showLogo=l:typeof l=="object"&&(g={...g,showLogo:!0,logoImageUrl:l.imageUrl,logoOnclickUrl:l.onClickUrl}),A.current=L.current.videoPlayer(p.current,{autoplayMode:d,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,color:r,controls:i,fontFace:t||"",loop:o,muted:n,publicId:E,secure:!0,...g}),Object.keys(D).forEach(I=>{var M;typeof D[I]=="function"&&((M=A.current)==null||M.on(I,G))})}}function J(){return{player:A.current,video:p.current}}return y.createElement(y.Fragment,null,y.createElement(he,null,y.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${U}/dist/cld-video-player.min.css`,rel:"stylesheet"})),y.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},y.createElement("video",{ref:p,id:z,className:"cld-video-player cld-fluid",width:O,height:u}),y.createElement(Ce,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${U}/dist/cld-video-player.min.js`,onLoad:q,onError:g=>console.error(`Failed to load Cloudinary Video Player: ${g.message}`)})))},K=Pe;export{X as CldImage,Y as CldOgImage,F as CldUploadButton,x as CldUploadWidget,K as CldVideoPlayer,R as cloudinaryLoader};
//# sourceMappingURL=index.mjs.map